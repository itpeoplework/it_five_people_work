<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVE DVE YC 'Cyber Science' For FS113371</title>
    <style>
        :root {
            --primary: #0a0a1f;
            --secondary: #121233;
            --accent: #00f0ff;
            --accent-dark: #0088cc;
            --text: #e0e0ff;
            --text-secondary: #a0a0cc;
            --card-bg: rgba(18, 18, 51, 0.7);
            --glow: 0 0 10px rgba(0, 240, 255, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 240, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 136, 204, 0.1) 0%, transparent 20%);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.3;
        }
        
        header {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: var(--text);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 2px solid var(--accent);
            box-shadow: var(--glow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.1), transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--accent);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        
        .team {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .team-member {
            background: var(--card-bg);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            border: 1px solid var(--accent-dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--accent-dark);
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-dark));
        }
        
        .intro-section {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(0, 240, 255, 0.3);
        }
        
        .intro-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent);
            box-shadow: var(--glow);
            margin: 1rem auto;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin: 1.5rem 0 1rem;
            text-align: center;
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10%;
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .content-card {
            background: rgba(10, 10, 31, 0.7);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--accent-dark);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 240, 255, 0.3);
        }
        
        .card-title {
            font-size: 1.3rem;
            color: var(--accent);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-title::before {
            content: '▹';
            color: var(--accent);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 240, 255, 0.3);
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            color: var(--primary);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            box-shadow: var(--glow);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
        }
        
        .btn-secondary:hover {
            background: rgba(0, 240, 255, 0.1);
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .page-indicator {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        #topBtn {
            position: fixed;
            right: 2rem;
            bottom: 2rem;
            display: none;
            z-index: 1000;
        }
        
        /* Presentation overlay styles */
        #presentationOverlay {
            position: fixed;
            inset: 0;
            background: rgba(5, 5, 15, 0.95);
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        #presentationOverlay.active {
            display: flex;
        }
        
        .slide-wrap {
            width: 90%;
            height: 90%;
            background: var(--card-bg);
            border-radius: 8px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .slide-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            gap: 1.5rem;
        }
        
        .slide-content h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin: 0;
            color: var(--accent);
        }
        
        .slide-content p {
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            line-height: 1.6;
            max-width: 900px;
        }
        
        .slide-files {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .slide-files img {
            max-height: 300px;
            max-width: 40%;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid var(--accent);
        }
        
        .pres-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            padding: 1rem;
            background: rgba(10, 10, 31, 0.8);
            border-top: 1px solid var(--accent-dark);
        }
        
        .pres-counter {
            color: var(--accent);
            font-size: 1rem;
            margin-left: 1rem;
            align-self: center;
        }
        
        .pres-btn {
            padding: 0.7rem 1.2rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            color: var(--primary);
            font-weight: bold;
        }
        
        .pres-btn:hover {
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.7);
        }
        
        .pres-topbar {
            position: absolute;
            left: 1.5rem;
            top: 1.5rem;
            color: var(--accent);
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .btn {
                padding: 0.7rem 1.2rem;
            }
        }
    </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script></head>
<body>

<header>
  <h1>DVE YC '' ICT Cyber Science'' Present&nbsp;</h1>
  <h1>For FS113371 / B1A&nbsp;</h1>
    <p>By Sam Tin , Franky Chan&nbsp; , Ben chui&nbsp; ,Chen Tsz Tim&nbsp; ,&nbsp;</p>
</header>

<div class="container" id="app">
  <h2 id="page-title" style="font-size: 23px"><img src="hw_210727_21.jpeg" width="960" height="960" alt=""/>&nbsp;Intro&nbsp;~ </h2>
  <p>_________________________________________________________________________________________&nbsp;</p>
  <h1>各位大家好 !&nbsp;&nbsp;</h1>
  <h1>以下即將會介紹 "社區介紹特色美食''</h1>
  <p>-------------------------------------------------------------------------------------------------------------------&nbsp;</p>
  <h1><em>&nbsp;屯門社區 :</em></h1>
  <p><strong>&nbsp;屯門，是香港一個充滿活力的地區，以豐富的菜餚和豐富多彩的美食而聞名。</strong></p>
  <p>-------------------------------------------------------------&nbsp;</p>

  <h2 style="font-family: Baskerville, 'Palatino Linotype', Palatino, 'Century Schoolbook L', 'Times New Roman', serif" class="pres-btn"><strong> 地方美食 :&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 海鮮盛宴&nbsp;</strong></h2>
  <h2 style="font-family: Baskerville, 'Palatino Linotype', Palatino, 'Century Schoolbook L', 'Times New Roman', serif" class="pres-btn"><strong>由於屯門靠近海岸，這裡以新鮮海鮮聞名。</strong></h2>
  <h2 style="font-family: Baskerville, 'Palatino Linotype', Palatino, 'Century Schoolbook L', 'Times New Roman', serif" class="pres-btn"><strong>屯門的海鮮市場熱鬧非凡，新鮮捕撈的蝦子、蟹魚隨手可得。試試燒烤魷魚或蒸魚，簡單又充滿風味。</strong></h2>
  <p class="container"><strong>屯門海鮮市場：這裡是當地著名的海鮮集散地，可以找到其中的新鮮海鮮。</strong></p>
  <p class="container"><strong>&nbsp;屯門碼頭附近的海鮮餐廳：許多餐廳直接從市場採購，提供最新鮮的海鮮菜餚。</strong></p>
  <p class="container">&nbsp;<strong>海濱公園附近的街頭小吃攤：這些攤位經常供應燒烤和快餐風格的海鮮。 &nbsp;</strong></p>
<p style="text-align: center">&nbsp;&nbsp;<strong style="font-family: 'Gill Sans', 'Gill Sans MT', 'Myriad Pro', 'DejaVu Sans Condensed', Helvetica, Arial, sans-serif">港式茶餐廳：</strong></p>
<p>&nbsp;<strong>港式茶餐廳是香港獨特的餐飲文化，提供舒適多元的美食，</strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<strong> 讓人感到親切與滿足。這些餐廳的氣氛輕鬆，</strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; <strong>適合各種場合，無論是早餐、午餐或晚餐</strong></p>
<p>&nbsp;</p>
<h2>&nbsp;</h2>
<h2><strong>&nbsp;</strong></h2>
  <table width="100%" border="1">
    <tbody>
      <tr>
        <td bgcolor="#000000">&nbsp;Franky Chan</td>
        <td bgcolor="#000000">&nbsp;Ben Chui</td>
        <td bgcolor="#000000">&nbsp;Chen Tsz Tim</td>
        <td bgcolor="#000000">&nbsp;</td>
        <td bgcolor="#000000">&nbsp;</td>
      </tr>
    </tbody>
  </table>
  

<div class="page-indicator" id="page-indicator">
  <p>&nbsp;</p>
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-family: 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', 'DejaVu Sans', Verdana, sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong> &nbsp;Page 1 of 10&nbsp;</strong></span></p>
</div>
	
  <!-- display area: rendered per page and changed by JS -->
    <div id="page-display">
        <p></p>
        <p></p>
        <p><em></em></p>
</div>

    
        <div class="upload-row">



    <div class="controls">
        <div>
            
            <button class="btn" id="nextBtn">下一頁</button>
           
      </div>
        
    </div>
</div>

<button class="btn" id="topBtn" title="回到頂部">回到頂部</button>

<!-- presentation overlay (PowerPoint-like slide view) -->
<div id="presentationOverlay" aria-hidden="true">
    <div class="slide-wrap" role="dialog" aria-modal="true" aria-label="Presentation view">
        <div class="pres-topbar" id="presTitle">Presentation</div>
        <div class="slide-content" id="slideContent">
            <!-- slide content injected by JS -->
            <h1></h1>
            <p></p>
            <div class="slide-files" id="slideFiles"></div>
        </div>
        <div class="pres-controls">
            <button class="pres-btn" id="presPrev">上一張</button>
            <button class="pres-btn" id="presPlay">播放</button>
            <button class="pres-btn" id="presNext">下一張</button>
            <button class="pres-btn" id="presExit">退出</button>
            <div class="pres-counter" id="presCounter">1 / 10</div>
        </div>
    </div>
</div>

<script>
    (function(){
        const STORAGE_KEY = 'project_pages_v1';
        const defaultPages = [];
        for (let person = 1; person <= 5; person++) {
            for (let p = 1; p <= 2; p++) {
                defaultPages.push({
                    title: `Person ${person} — Page ${p}`,
                    content: [
                       
                    ].join('\n\n'),
                    note: '',
                    files: [] // {name,type,dataURL,ts}
                });
            }
        }

        // load stored pages if exists and ensure length=10
        function loadPagesFromStorage() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return defaultPages.slice();
                const parsed = JSON.parse(raw);
                if (!Array.isArray(parsed)) return defaultPages.slice();
                // ensure exactly 10 pages: fill or truncate
                const pages = defaultPages.slice();
                for (let i = 0; i < Math.min(parsed.length, 10); i++) {
                    pages[i] = Object.assign(pages[i], parsed[i]);
                    pages[i].files = parsed[i].files || [];
                }
                return pages;
            } catch (e) {
                console.warn('Failed to load pages', e);
                return defaultPages.slice();
            }
        }
        function savePagesToStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
            } catch (e) {
                console.warn('Failed to save pages', e);
            }
        }

        let pages = loadPagesFromStorage();
        let current = 0;
        const total = pages.length;

        const titleEl = document.getElementById('page-title');
        const displayEl = document.getElementById('page-display');
        const indicator = document.getElementById('page-indicator');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const topBtn = document.getElementById('topBtn');
        const supportInput = document.getElementById('supportInput');
        const fileInput = document.getElementById('fileInput');
        const previews = document.getElementById('previews');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const insertLongBtn = document.getElementById('insertLongBtn');
        const app = document.getElementById('app');
        // long sample text (replace with your preferred long introduction)
        const longSampleText = `Hello, my name is [Name]. I am [age] years old and my interests include computer science, coding, troubleshooting, research, digital communication, and creative projects. I use computers and digital tools every day to study, collaborate, and support others. I have experience with various software, document formats, image editing, and online presentation tools. I enjoy learning new technologies and applying them to solve problems and build useful systems. This long text is provided so you can quickly fill the introduction area for testing or demonstration purposes. Feel free to edit any part of it to reflect your personal details.`;

        // insert/append long sample text into textarea
        if (insertLongBtn) {
            insertLongBtn.addEventListener('click', () => {
                const current = supportInput.value || '';
                // append with spacing if there is existing text
                supportInput.value = current ? (current + '\n\n' + longSampleText) : longSampleText;
                // small visual feedback
                insertLongBtn.textContent = '已插入';
                setTimeout(()=> insertLongBtn.textContent = '插入長文本', 900);
            });
        }

        // --- Presentation mode additions ---
        const presentBtn = document.getElementById('presentBtn');
        const autoplayCheckbox = document.getElementById('autoplayCheckbox');
        const overlay = document.getElementById('presentationOverlay');
        const slideContent = document.getElementById('slideContent');
        const slideFiles = document.getElementById('slideFiles');
        const presPrev = document.getElementById('presPrev');
        const presNext = document.getElementById('presNext');
        const presExit = document.getElementById('presExit');
        const presPlay = document.getElementById('presPlay');
        const presCounter = document.getElementById('presCounter');
        let presActive = false;
        let presIndex = 0;
        let presInterval = null;

        // helper to create file preview node
        function createFileNode(fileObj, idx) {
            const div = document.createElement('div');
            div.className = 'file-item';
            if (fileObj.type && fileObj.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = fileObj.dataURL;
                img.className = 'thumb';
                div.appendChild(img);
            } else {
                const ico = document.createElement('div');
                ico.style.minWidth='40px';
                ico.style.minHeight='40px';
                ico.style.display='flex';
                ico.style.alignItems='center';
                ico.style.justifyContent='center';
                ico.style.background='#efefef';
                ico.style.borderRadius='4px';
                ico.textContent = fileObj.name.split('.').pop().toUpperCase();
                div.appendChild(ico);
            }
            const meta = document.createElement('div');
            meta.style.flex='1';
            meta.innerHTML = `<div><strong>${escapeHtml(fileObj.name)}</strong></div><div class="meta">${fileObj.type || 'file'} • ${(new Date(fileObj.ts)).toLocaleString()}</div>`;
            div.appendChild(meta);

            const actions = document.createElement('div');
            const dl = document.createElement('a');
            dl.href = fileObj.dataURL;
            dl.download = fileObj.name;
            dl.textContent = 'Download';
            dl.className = 'btn';
            dl.style.marginRight='8px';
            actions.appendChild(dl);

            const rm = document.createElement('button');
            rm.className = 'remove-btn';
            rm.textContent = 'Remove';
            rm.addEventListener('click', () => {
                pages[current].files.splice(idx,1);
                savePagesToStorage();
                render(current);
            });
            actions.appendChild(rm);
            div.appendChild(actions);
            return div;
        }

        function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

        // layout renderers
        function renderSimple(pg) {
            return `<div><p>${pg.content.split('\n\n').map(escapeHtml).join('</p><p>')}</p></div>`;
        }
        function renderTwoCol(pg, filesHtml) {
            return `<div class="two-col"><div>${pg.content.split('\n\n').map(escapeHtml).join('<br/>')}</div><div>${filesHtml}</div></div>`;
        }
        function renderGallery(pg, filesHtml) {
            return `<div><p>${escapeHtml(pg.content)}</p><div class="gallery">${filesHtml}</div></div>`;
        }
        function renderCentered(pg, filesHtml) {
            return `<div class="centered"><h3>${escapeHtml(pg.title)}</h3><p>${escapeHtml(pg.content)}</p><div>${filesHtml}</div></div>`;
        }
        function renderTimeline(pg, filesHtml) {
            return `<div class="timeline"><p>${escapeHtml(pg.content)}</p><div>${filesHtml}</div></div>`;
        }

        function buildFilesHtml(fileObjs) {
            // for gallery we want image tags; for other layouts we use file list placeholders
            return fileObjs.map((f, idx) => {
                if (f.type && f.type.startsWith('image/')) {
                    return `<img src="${f.dataURL}" class="thumb" alt="${escapeHtml(f.name)}">`;
                } else {
                    return `<div class="file-item"><strong>${escapeHtml(f.name)}</strong><div class="meta">${escapeHtml(f.type||'file')}</div></div>`;
                }
            }).join('');
        }

        function render(idx) {
            const pg = pages[idx];
            titleEl.textContent = `${pg.title}`;
            indicator.textContent = `Page ${idx+1} of ${total}`;

            // choose a layout variant (5 variants)
            const variant = idx % 5;
            const filesHtml = buildFilesHtml(pg.files || []);
            let html = '';
            if (variant === 0) html = renderSimple(pg);
            else if (variant === 1) html = renderTwoCol(pg, filesHtml);
            else if (variant === 2) html = renderGallery(pg, filesHtml);
            else if (variant === 3) html = renderCentered(pg, filesHtml);
            else html = renderTimeline(pg, filesHtml);

            displayEl.innerHTML = html;

            // load textarea note
            supportInput.value = pg.note || '';

            // render previews area (with controls)
            previews.innerHTML = '';
            (pg.files || []).forEach((f, i) => {
                previews.appendChild(createFileNode(f, i));
            });

            // show top button
            topBtn.style.display = 'block';
            nextBtn.focus();
            app.scrollIntoView({behavior: 'smooth', block: 'start'});
        }

        // handle file input: read as dataURL and store metadata
        fileInput.addEventListener('change', (ev) => {
            const files = Array.from(ev.target.files || []);
            if (!files.length) return;
            let pending = files.length;
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    pages[current].files = pages[current].files || [];
                    pages[current].files.push({
                        name: file.name,
                        type: file.type,
                        dataURL: e.target.result,
                        ts: Date.now()
                    });
                    pending--;
                    if (pending === 0) {
                        savePagesToStorage();
                        render(current);
                        fileInput.value = '';
                    }
                };
                reader.readAsDataURL(file);
            });
        });

        // Save note explicitly
        if (saveNoteBtn) {
            saveNoteBtn.addEventListener('click', () => {
                pages[current].note = supportInput.value;
                savePagesToStorage();
                // quick feedback
                const prev = saveNoteBtn.textContent;
                saveNoteBtn.textContent = '已儲存';
                setTimeout(()=> saveNoteBtn.textContent = prev, 900);
            });
        }

        // navigation
        nextBtn.addEventListener('click', () => {
            // autosave note before leaving
            pages[current].note = supportInput.value;
            current = (current + 1) % total;
            savePagesToStorage();
            render(current);
        });
        prevBtn.addEventListener('click', () => {
            pages[current].note = supportInput.value;
            current = (current - 1 + total) % total;
            savePagesToStorage();
            render(current);
        });

        // back to top
        topBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // --- Presentation mode functions ---
        function buildSlideFilesHtml(fileObjs) {
            // create elements inside slideFiles rather than a string for control
            slideFiles.innerHTML = '';
            (fileObjs || []).forEach(f => {
                if (f.type && f.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = f.dataURL;
                    img.alt = f.name;
                    slideFiles.appendChild(img);
                }
            });
        }

        function renderSlide(idx) {
            const pg = pages[idx];
            // title: show page title or first line
            const titleText = pg.title || `Page ${idx+1}`;
            const bodyText = (pg.note && pg.note.trim()) ? pg.note : pg.content;
            // inject
            slideContent.querySelector('h1').textContent = titleText;
            slideContent.querySelector('p').textContent = (typeof bodyText === 'string') ? bodyText : String(bodyText);
            buildSlideFilesHtml(pg.files || []);
            presCounter.textContent = `${idx+1} / ${total}`;
        }

        function startPresentation(startAt = current) {
            // autosave current note
            pages[current].note = supportInput.value;
            savePagesToStorage();

            presActive = true;
            presIndex = startAt;
            overlay.classList.add('active');
            overlay.setAttribute('aria-hidden','false');
            renderSlide(presIndex);
            // try fullscreen for immersive effect (optional)
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(()=>{/* ignore */});
            }
            // auto-play if checked
            if (autoplayCheckbox.checked) startAutoPlay();
        }

        function stopPresentation() {
            presActive = false;
            overlay.classList.remove('active');
            overlay.setAttribute('aria-hidden','true');
            stopAutoPlay();
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(()=>{/* ignore */});
            }
        }

        function nextSlide() {
            presIndex = (presIndex + 1) % total;
            renderSlide(presIndex);
        }
        function prevSlide() {
            presIndex = (presIndex - 1 + total) % total;
            renderSlide(presIndex);
        }

        function startAutoPlay() {
            stopAutoPlay();
            presInterval = setInterval(() => {
                nextSlide();
            }, 4000);
            presPlay.textContent = '暫停';
        }
        function stopAutoPlay() {
            if (presInterval) { clearInterval(presInterval); presInterval = null; }
            presPlay.textContent = '播放';
        }

        // Wire presentation controls
        presentBtn.addEventListener('click', () => {
            if (!presActive) startPresentation(current);
            else stopPresentation();
        });
        presExit.addEventListener('click', stopPresentation);
        presNext.addEventListener('click', nextSlide);
        presPrev.addEventListener('click', prevSlide);
        presPlay.addEventListener('click', () => {
            if (presInterval) stopAutoPlay(); else startAutoPlay();
        });

        // Keyboard handling while presentation is active
        document.addEventListener('keydown', (e) => {
            if (presActive) {
                if (e.key === 'ArrowRight') { nextSlide(); e.preventDefault(); }
                if (e.key === 'ArrowLeft') { prevSlide(); e.preventDefault(); }
                if (e.key === 'Escape') { stopPresentation(); e.preventDefault(); }
            } else {
                // existing navigation keys when not in presentation
                if (e.key === 'ArrowRight') nextBtn.click();
                if (e.key === 'ArrowLeft') prevBtn.click();
            }
        });

        // Ensure when overlay enters/exits fullscreen, we keep state consistent
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && presActive) {
                // if user exited fullscreen but overlay still active, keep overlay visible
                // no action required; presentation continues
            }
        });

        // initial render
        render(current);

        // keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextBtn.click();
            if (e.key === 'ArrowLeft') prevBtn.click();
        });
    })();
</script>

</body></html>
